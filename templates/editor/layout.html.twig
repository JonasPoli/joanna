{% extends 'base.html.twig' %}

{% block body %}
<div class="flex min-h-screen bg-base-200">
  <!-- Sidebar -->
  <aside id="sidebar" class="sidebar-collapsed bg-base-100 border-r border-base-300 flex flex-col transition-all duration-300 z-30">
    <!-- Hamburger Toggle -->
    <div class="p-3 border-b border-base-300">
      <button id="sidebar-toggle" class="btn btn-ghost btn-sm w-full">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
    
    <!-- Menu Items -->
    <ul class="menu flex-1 p-2">
      <li>
        <a href="{{ path('app_editor_dashboard') }}" class="tooltip tooltip-right {{ app.request.attributes.get('_route') == 'app_editor_dashboard' ? 'active' : '' }}" data-tip="Dashboard">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
          <span class="menu-text">Dashboard</span>
        </a>
      </li>
      
      <li class="menu-title mt-4 hidden-collapsed"><span class="menu-text">Referências</span></li>
      
      <li>
        <a href="{{ path('app_editor_joanna_reference_all') }}" class="tooltip tooltip-right {{ app.request.attributes.get('_route') == 'app_editor_joanna_reference_all' ? 'active' : '' }}" data-tip="Todas Referências">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg>
          <span class="menu-text">Todas Referências</span>
        </a>
      </li>
      <li>
        <a href="{{ path('app_editor_joanna_reference_index') }}" class="tooltip tooltip-right {{ app.request.attributes.get('_route') == 'app_editor_joanna_reference_index' ? 'active' : '' }}" data-tip="Minhas Referências">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>
          <span class="menu-text">Minhas Referências</span>
        </a>
      </li>
      <li>
        <a href="{{ path('app_editor_joanna_reference_new') }}" class="tooltip tooltip-right {{ app.request.attributes.get('_route') == 'app_editor_joanna_reference_new' ? 'active' : '' }}" data-tip="Adicionar Nova">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
          <span class="menu-text">Adicionar Nova</span>
        </a>
      </li>
      <li>
        <a href="{{ path('app_admin_message_index') }}" class="tooltip tooltip-right {{ app.request.attributes.get('_route') starts with 'app_admin_message' ? 'active' : '' }}" data-tip="Mensagens">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" /></svg>
          <span class="menu-text">Mensagens</span>
          {% set pendingCount = pending_message_count() %}
          {% if pendingCount > 0 %}
            <span class="badge badge-error badge-sm">{{ pendingCount }}</span>
          {% endif %}
        </a>
      </li>
    </ul>
    
    <!-- Bottom section -->
    <div class="border-t border-base-300 p-2">
      <ul class="menu">
        <li>
          <a href="{{ path('app_logout') }}" class="tooltip tooltip-right" data-tip="Sair">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
            <span class="menu-text">Sair</span>
          </a>
        </li>
      </ul>
    </div>
  </aside>

  <!-- Main Content -->
  <div class="flex-1 flex flex-col">
    <!-- Navbar -->
    <div class="navbar bg-base-100 shadow-sm border-b border-base-300">
      <div class="flex-1 px-4">
        <span class="text-lg font-bold">Painel do Editor</span>
      </div>
      <div class="flex-none gap-2">
        {% if is_granted('IS_IMPERSONATOR') %}
            <a href="{{ path('app_admin_dashboard', {'_switch_user': '_exit'}) }}" class="btn btn-error btn-sm text-white">
                Sair do modo de visualização
            </a>
        {% endif %}
        <a href="{{ path('app_admin_message_index') }}" class="btn btn-ghost btn-circle">
          <div class="indicator">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg>
            {% set pendingCount = pending_message_count() %}
            {% if pendingCount > 0 %}
              <span class="badge badge-xs badge-error indicator-item">{{ pendingCount }}</span>
            {% endif %}
          </div>
        </a>
        <div class="dropdown dropdown-end">
          <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar">
            <div class="w-10 rounded-full">
              <img alt="Avatar" src="https://ui-avatars.com/api/?name={{ app.user.name|default('E') }}&background=random" />
            </div>
          </div>
          <ul tabindex="0" class="mt-3 z-[1] p-2 shadow menu menu-sm dropdown-content bg-base-100 rounded-box w-52">
            <li><a href="{{ path('app_logout') }}">Logout</a></li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Page Content -->
    <div class="p-6 flex-1 overflow-auto">
        {% block editor_content %}{% endblock %}
    </div>
  </div>
</div>

<style>
  #sidebar {
    width: 256px;
  }
  #sidebar.sidebar-collapsed {
    width: 64px;
  }
  #sidebar.sidebar-collapsed .menu-text,
  #sidebar.sidebar-collapsed .badge,
  #sidebar.sidebar-collapsed .menu-title,
  #sidebar.sidebar-collapsed .hidden-collapsed {
    display: none;
  }
  #sidebar.sidebar-collapsed .menu a {
    justify-content: center;
    padding-left: 0;
    padding-right: 0;
  }
  /* Hide tooltips when sidebar is expanded */
  #sidebar:not(.sidebar-collapsed) .tooltip::before,
  #sidebar:not(.sidebar-collapsed) .tooltip::after {
    display: none !important;
  }
  /* Fix: ensure menu items are inline-flex for proper alignment */
  #sidebar .menu a {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 0.75rem;
  }
  #sidebar .menu a svg {
    flex-shrink: 0;
  }
</style>

<script>
  document.getElementById('sidebar-toggle').addEventListener('click', function() {
    document.getElementById('sidebar').classList.toggle('sidebar-collapsed');
  });
</script>
{% endblock %}
